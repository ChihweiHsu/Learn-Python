目標: 學習並了解Bokeh 如何應用

重點: 

初步了解 BOKEH 互動式GUIDE LINE
    
自定義和組織資料數據可視化

為可視化添加交互姓 --- CustomJS/Render

作業: 

1.建立簡單的水果資料集
fruits = ['Apples', 'Pears', 'Nectarines', 'Plums', 'Grapes', 'Strawberries']

counts = [5, 3, 4, 2, 4, 6]

2. 利用 Source 建立字典, 再用figure 輸出 BAR 圖
source = ColumnDataSource(data=dict(fruits=fruits, counts=counts, color=Spectral6))

3. Bokeh官方有提供sample_data給大家練習，gallery豐富的範例都取自sample_data，對比官方的資料格式就能輕鬆模仿應用, 下載 股市資料

4. 使用HoverTool(游標滑過時顯示資料); Click_policy (藉由標籤控制數值顯示)


# 利用 Bokeh 與 Python 製作網頁互動視覺化

設定資料與輸出檔案
output_file(“out.html”)
利用 Bokeh 繪製圖表
p = figure()
p.line([1,2,3,4,5], [5,4,3,2,1])
開啟產生的 HTML 檔 ( HTML + JavaScript ，自動生成 )
show(p)


```python
from bokeh.plotting import figure, output_file, show
from bokeh.models import widgets
from bokeh.io import output_notebook
import numpy as np


# 讓網頁直接輸出在NOTEBOOK
output_notebook()

```



<div class="bk-root">
    <a href="https://bokeh.org" target="_blank" class="bk-logo bk-logo-small bk-logo-notebook"></a>
    <span id="1001">Loading BokehJS ...</span>
</div>





```python
#Bokeh官方有提供sample_data給大家練習，gallery豐富的範例都取自sample_data。
#下載sample_data指令為bokeh.sampledata.download()，直接貼在jupyter執行。檔案會下載到bokeh module裡。
import bokeh.sampledata
bokeh.sampledata.download()
```

    Using data directory: /Users/xuzhiwei/.bokeh/data
    Skipping 'CGM.csv' (checksum match)
    Skipping 'US_Counties.zip' (checksum match)
    Skipping 'us_cities.json' (checksum match)
    Skipping 'unemployment09.csv' (checksum match)
    Skipping 'AAPL.csv' (checksum match)
    Skipping 'FB.csv' (checksum match)
    Skipping 'GOOG.csv' (checksum match)
    Skipping 'IBM.csv' (checksum match)
    Skipping 'MSFT.csv' (checksum match)
    Skipping 'WPP2012_SA_DB03_POPULATION_QUINQUENNIAL.zip' (checksum match)
    Skipping 'gapminder_fertility.csv' (checksum match)
    Skipping 'gapminder_population.csv' (checksum match)
    Skipping 'gapminder_life_expectancy.csv' (checksum match)
    Skipping 'gapminder_regions.csv' (checksum match)
    Skipping 'world_cities.zip' (checksum match)
    Skipping 'airports.json' (checksum match)
    Skipping 'movies.db.zip' (checksum match)
    Skipping 'airports.csv' (checksum match)
    Skipping 'routes.csv' (checksum match)
    Skipping 'haarcascade_frontalface_default.xml' (checksum match)


## 1. 建立簡單的水果資料集 fruits = ['Apples', 'Pears', 'Nectarines', 'Plums', 'Grapes', 'Strawberries']counts = [5, 3, 4, 2, 4, 6]


```python
from bokeh.models import ColumnDataSource
from bokeh.palettes import Spectral6
from bokeh.models import ColumnDataSource, HoverTool
from bokeh.plotting import figure

fruits = ['Apples', 'Pears', 'Nectarines', 'Plums', 'Grapes', 'Strawberries']
counts = [5, 3, 4, 2, 4, 6]

source = ColumnDataSource(data=dict(fruits=fruits, counts=counts, color=Spectral6))

p = figure(x_range=fruits, y_range=(0,9), plot_height=250, title="Fruit Counts",
           toolbar_location=None, tools="")
p.vbar(x='fruits', top='counts', width=0.9, source=source, legend_field="fruits",
       line_color='white')

p.xgrid.grid_line_color = None 
p.legend.orientation = "horizontal"
p.legend.location = "top_center"

show(p)
```








<div class="bk-root" id="0b8864a0-686a-4966-9b47-eab4f40e7b9c" data-root-id="1522"></div>






```python
from bokeh.models import FactorRange
from bokeh.transform import factor_cmap

fruits = ['Apples', 'Pears', 'Nectarines', 'Plums', 'Grapes', 'Strawberries']
years = ['2015', '2016', '2017']

data = {'fruits' : fruits,
        '2015'   : [2, 1, 4, 3, 2, 4],
        '2016'   : [5, 3, 3, 2, 4, 6],
        '2017'   : [3, 2, 4, 4, 5, 3]}

# this creates [ ("Apples", "2015"), ("Apples", "2016"), ("Apples", "2017"), ("Pears", "2015), ... ]


x = [ (fruit, year) for fruit in fruits for year in years ]
counts = sum(zip(data['2015'], data['2016'], data['2017']), ()) # like an hstack

source = ColumnDataSource(data=dict(x=x, counts=counts))

p = figure(x_range=FactorRange(*x), plot_height=250, title="Fruit Counts by Year",
           toolbar_location=None, tools="")

p.vbar(x='x', top='counts', width=0.9, source=source, line_color="white",  # use the palette to colormap based on the the x[1:2] values
       fill_color=factor_cmap('x', palette= Spectral6 ,factors=years, start=1, end=2))

p.y_range.start = 0
p.x_range.range_padding = 0.1
p.xaxis.major_label_orientation = 1
p.xgrid.grid_line_color = None

show(p)
```








<div class="bk-root" id="6dcc81d9-c874-4dc2-848f-62737743cc99" data-root-id="1804"></div>






```python
import bokeh.io
from bokeh.resources import INLINE
from bokeh.models import HoverTool
from bokeh.palettes import Spectral4
from bokeh.plotting import figure, output_file, show, output_notebook, ColumnDataSource
from bokeh.sampledata.stocks import AAPL, GOOG, IBM, MSFT
import pandas as pd

# 環境 settings
bokeh.io.reset_output()
bokeh.io.output_notebook(INLINE)


# set hover
## HoverTool
# 游標滑過時顯示資料,date格式需要轉換，不然會是timestamp
hover = HoverTool(
    tooltips = [
        ("date", "@date"),
        ("close", "@open"),
        ("close", "@close"),
        ("high", "@high"),
        ("low", "@low"),
        ("volume","@volume")
    ], 
    formatters={"@date":"datetime"}
)


# set figure
p = figure(plot_width=1000, 
    plot_height=400, 
    x_axis_type="datetime",
    tools=[hover,"pan,box_zoom,reset,save"],)
p.title.text = 'Stock_Price--Click on legend entries to mute the corresponding lines and show daily details in hover'

# use ColumnDataSource to control
# click_policy
# 藉由標籤控制數值顯示
# hide為隱藏，mute為切換自訂顯示模式
# 可在muted_color控制顏色, muted_alpha控制顏色濃淡

for data, name, color in zip([AAPL, IBM, MSFT, GOOG], ["AAPL", "IBM", "MSFT", "GOOG"], Spectral4):
    df = pd.DataFrame(data)
    df['date'] = pd.to_datetime(df['date'])
    source = ColumnDataSource(df)
    p.line(x="date",y="close", line_width=2, color=color, alpha=0.8,
           muted_color=color, muted_alpha=0.2, legend_label=name,source=source)


p.legend.location = "top_left"
# use hide or mute
p.legend.click_policy="mute"

# output_file("interactive_legend.html", title="interactive_legend.py example")

show(p)
output_notebook() 

```



<div class="bk-root">
    <a href="https://bokeh.org" target="_blank" class="bk-logo bk-logo-small bk-logo-notebook"></a>
    <span id="1919">Loading BokehJS ...</span>
</div>











<div class="bk-root" id="8e2c35de-c05a-4a75-8547-af86b616d461" data-root-id="1921"></div>







<div class="bk-root">
    <a href="https://bokeh.org" target="_blank" class="bk-logo bk-logo-small bk-logo-notebook"></a>
    <span id="2241">Loading BokehJS ...</span>
</div>



